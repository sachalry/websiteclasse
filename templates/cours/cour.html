<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cours du {{cours['date'] | format_date}}</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="shortcut icon" href="/static/icon.ico" type="image/x-icon">
</head>
<body>
    <header class="header">
        <nav class="header_links">
            <a href="/" class="header__link">Acceuil</a>
            <a href="/cours/" class="header__link">Cours</a>
        </nav>
        <h1 class="header_title">âœ¦TermGâœ¦</h1>
        <nav class="header_links">
            <a href="/revision/" class="header__link">RÃ©vision</a>
            <a href="" class="header__link">Feuille de semaine</a>
        </nav>
    </header>
    <main>
        <div id="image-modal" class="modal">
            <span class="modal-close">&times;</span>
            <img class="modal-content" id="modal-img">
            <a class="modal-link" id="modal-link" href="/" target="_blank">ouvrir dans un nouvel onglet â†—</a>
        </div>
        <section class="matiere-section">
            <h1 class="cours-title">Cours du {{ cours['date']  | format_date}}, {{cours["title"]}}</h1>
            <div class="cours-contenu">
                <h2 class="contenu-title">Contenu du cours :</h2>
                <p class="contenu-description">{{ cours['contenu'] }}</p>
            </div>
            <p class="cours-auteur">Ecrit par {{ cours['auteur'] }}</p>
            <div class="cours-imgs">
                <h2 class="imgs-title">Image(s) du cours :</h2>
                {% if images|length == 0 %}
                    <p class="no-imgs">Aucune image n'a Ã©tÃ© ajoutÃ©e pour ce cours.</p>
                {% else %}
                <div class="list-imgs">
                    {% for image in images %}
                        <buttton class="button-img">
                            <img src="{{ url_for('static', filename='uploads/' ~ image['filename']) }}" alt="Image associÃ©e au cours" style="max-width: 300px;">
                        </button>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            <a class="cours__link-back" href="{{ url_for('cours') }}">ðŸ”™ Retour aux matiÃ¨res</a>
        </section>
    </main>
</body>
<script src="/static/script.js"></script>
<script>
const modal = document.getElementById("image-modal");
const modalImg = document.getElementById("modal-img");
const closeBtn = document.querySelector(".modal-close");

document.querySelectorAll(".button-img img").forEach(img => {
    img.addEventListener("click", () => {
        modal.style.display = "flex";       // affiche l'overlay
        modalImg.src = img.src;             // met la bonne image
        document.getElementById("modal-link").href = img.src; // met le bon lien
        setTimeout(() => {
            modal.classList.add("show");   
        }, 1);
    });
});

closeBtn.addEventListener("click", () => {
    modal.classList.remove("show");        // animation de fermeture
    setTimeout(() => {                     // attend la fin de l'animation
        modal.style.display = "none";
    }, 300);
});

// Fermer si clic en dehors de l'image
modal.addEventListener("click", e => {
    if (e.target === modal) {
        modal.classList.remove("show");
        setTimeout(() => {
            modal.style.display = "none";
        }, 300);
    }
});

// Zoom sur clic
modalImg.addEventListener("click", e => {
    e.stopPropagation(); // empÃªche de fermer le modal

    if (!modalImg.classList.contains("zoomed")) {

        const rect = modalImg.getBoundingClientRect();

        // Position du curseur dans l'image
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        // Conversion en pourcentage
        const xPercent = (x / rect.width) * 100;
        const yPercent = (y / rect.height) * 100;

        // DÃ©finit le point d'origine du zoom
        modalImg.style.transformOrigin = `${xPercent}% ${yPercent}%`;
    }

    modalImg.classList.toggle("zoomed"); // toggle zoom
});


</script>
</html>
